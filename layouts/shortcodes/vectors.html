<div style="background: #0f172a; color: #f8fafc; padding: 25px; border-radius: 20px; max-width: 1050px; font-family: system-ui, sans-serif; box-shadow: 0 25px 50px rgba(0,0,0,0.5); margin: 20px auto; border: 1px solid #1e293b; user-select: none;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #1e293b; padding-bottom: 20px;">
        <div style="display: flex; align-items: center; gap: 20px;">
            <h2 style="margin: 0; color: #34d399; font-size: 2rem; letter-spacing: -1.5px;">&lt;VectorLab /&gt;</h2>
            <button onclick="resetAll()" style="background: #1e293b; color: #f87171; border: 1px solid #f8717144; padding: 6px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.9rem;">RESET ALL</button>
        </div>
        <div style="display: flex; gap: 20px; align-items: center; font-size: 1.1rem;">
            <div class="dropdown-group">
                <span style="font-weight: bold;">Pos Snap:</span>
                <select id="posSnapSelect" onchange="render()" style="font-size: 1rem; padding: 4px;">
                    <option value="0.01">None</option>
                    <option value="0.1">0.10</option>
                    <option value="0.25" selected>0.25</option>
                    <option value="0.5">0.50</option>
                    <option value="1">1.00</option>
                </select>
            </div>
            <div class="dropdown-group">
                <span style="font-weight: bold;">Rot Snap:</span>
                <select id="rotSnapSelect" onchange="render()" style="font-size: 1rem; padding: 4px;">
                    <option value="1">None</option>
                    <option value="5">5°</option>
                    <option value="15" selected>15°</option>
                    <option value="30">30°</option>
                    <option value="45">45°</option>
                    <option value="90">90°</option>
                </select>
            </div>
            <label class="custom-checkbox" style="font-size: 1rem;">
                <input type="checkbox" id="unitToggle" onchange="toggleUnitMode()">
                <span>Unit Only</span>
            </label>
            <label class="custom-checkbox" style="font-size: 1rem;">
                <input type="checkbox" id="angleModeToggle" onchange="render()">
                <span>Local Rot</span>
            </label>
        </div>
    </div>

    <div style="display: flex; gap: 30px; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 450px; display: flex; flex-direction: column; align-items: center;">
            <canvas id="vectorCanvas" width="500" height="500" style="background: #020617; border-radius: 12px; border: 1px solid #334155; width: 100%; height: auto; touch-action: none; cursor: crosshair;"></canvas>
            <div id="originCoords" style="margin-top: 15px; font-family: monospace; color: #f8fafc; font-size: 1.2rem; background: #1e293b; padding: 10px 22px; border-radius: 8px; border: 1px solid #334155; display: flex; gap: 30px;">
                <span>Pos: (0.00, 0.00)</span>
                <span style="color: #34d399;">Dist: 0.00</span>
            </div>
        </div>

        <div style="width: 420px; display: flex; flex-direction: column; gap: 15px;">
            
            <div style="display: flex; gap: 15px; background: #020617; padding: 18px 25px 18px 18px; border-radius: 12px; border: 1px solid #1e293b; border-left: 5px solid #60a5fa;">
                <div class="rot-container" onmouseenter="hoverRot=0;render()" onmouseleave="hoverRot=null;render()">
                    <div class="rot-scale"><span>359°</span><span>0°</span></div>
                    <input type="range" class="rot-slider" id="rotSlider0" min="0" max="359" step="1" oninput="rotateVec(0, this.value)">
                </div>
                <div style="flex: 1;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span style="color: #60a5fa; font-weight: bold; font-size: 1.2rem;">Vector A</span>
                        <div style="display: flex; gap: 12px;">
                            <div class="stepper-wrap"><span>X:</span><div class="stepper"><button onclick="step(0,'x',-1)">-</button><input type="text" id="ax_in" oninput="validateInput(0,'x',this)"><button onclick="step(0,'x',1)">+</button></div></div>
                            <div class="stepper-wrap"><span>Y:</span><div class="stepper"><button onclick="step(0,'y',-1)">-</button><input type="text" id="ay_in" oninput="validateInput(0,'y',this)"><button onclick="step(0,'y',1)">+</button></div></div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; margin: 15px 0;">
                        <input type="range" class="vec-slider" id="slider0" min="0" max="5" step="0.01" oninput="updateLen(0, this.value)" style="flex: 1; margin: 0;">
                        <div class="stepper-wrap"><span>L:</span><div class="stepper" style="border-color: #475569;"><button onclick="stepLen(0,-1)">-</button><input type="text" id="len0_in" oninput="validateLen(0,this)"><button onclick="stepLen(0,1)">+</button></div></div>
                    </div>
                    <div style="display: flex; gap: 6px;">
                        <button class="tool-btn" onclick="transform(0, 'negate')">NEGATE</button>
                        <button class="tool-btn" onclick="transform(0, 'perp')">PERP</button>
                        <button class="tool-btn" onclick="transform(0, 'norm')">NORM</button>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 15px; background: #020617; padding: 18px 25px 18px 18px; border-radius: 12px; border: 1px solid #1e293b; border-left: 5px solid #f87171;">
                <div class="rot-container" onmouseenter="hoverRot=1;render()" onmouseleave="hoverRot=null;render()">
                    <div class="rot-scale"><span>359°</span><span>0°</span></div>
                    <input type="range" class="rot-slider" id="rotSlider1" min="0" max="359" step="1" oninput="rotateVec(1, this.value)">
                </div>
                <div style="flex: 1;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span style="color: #f87171; font-weight: bold; font-size: 1.2rem;">Vector B</span>
                        <div style="display: flex; gap: 12px;">
                            <div class="stepper-wrap"><span>X:</span><div class="stepper"><button onclick="step(1,'x',-1)">-</button><input type="text" id="bx_in" oninput="validateInput(1,'x',this)"><button onclick="step(1,'x',1)">+</button></div></div>
                            <div class="stepper-wrap"><span>Y:</span><div class="stepper"><button onclick="step(1,'y',-1)">-</button><input type="text" id="by_in" oninput="validateInput(1,'y',this)"><button onclick="step(1,'y',1)">+</button></div></div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; margin: 15px 0;">
                        <input type="range" class="vec-slider" id="slider1" min="0" max="5" step="0.01" oninput="updateLen(1, this.value)" style="flex: 1; margin: 0;">
                        <div class="stepper-wrap"><span>L:</span><div class="stepper" style="border-color: #475569;"><button onclick="stepLen(1,-1)">-</button><input type="text" id="len1_in" oninput="validateLen(1,this)"><button onclick="stepLen(1,1)">+</button></div></div>
                    </div>
                    <div style="display: flex; gap: 6px;">
                        <button class="tool-btn" onclick="transform(1, 'negate')">NEGATE</button>
                        <button class="tool-btn" onclick="transform(1, 'perp')">PERP</button>
                        <button class="tool-btn" onclick="transform(1, 'norm')">NORM</button>
                    </div>
                </div>
            </div>

            <div style="background: #1e293b; padding: 22px; border-radius: 12px; border: 1px solid #334155;">
                <div style="font-family: monospace; color: #cbd5e1; line-height: 1.8; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 15px; font-size: 1rem;">
                    Dot Product: <span id="resDot" style="color:#fff; font-weight:bold;">0.000</span><br>
                    Cosine (θ): <span id="resCos" style="color:#fff;">0.000</span><br>
                    Angle: <span id="resDeg" style="color:#fff;">0</span>° | <span id="resRad" style="color:#fff;">0.000</span> rad<br>
                    Pi: <span id="resPi" style="color:#fff; font-weight: bold;">0.00π</span> <span id="resFrac" style="color:#fff; margin-left:10px;"></span>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin:0; color:#34d399; font-size:0.9rem; text-transform:uppercase; letter-spacing:1px;">Basis Matrix</h4>
                    <button onclick="transpose()" class="tool-btn" style="flex:none; padding: 4px 12px; border-color:#34d399; color:#34d399;">TRANSPOSE</button>
                </div>
                
                <div style="display: flex; justify-content: center;">
                    <div style="border-left: 3px solid #fff; border-right: 3px solid #fff; padding: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; background: #0f172a; border-radius: 6px;">
                        <div class="stepper-wrap"><span style="color:#60a5fa; font-size:0.8rem">A₁</span><div class="stepper" style="border-color:#60a5fa33;"><button onclick="step(0,'x',-1)">-</button><input type="text" id="m00_in" oninput="validateInput(0,'x',this)" style="color:#60a5fa;"><button onclick="step(0,'x',1)">+</button></div></div>
                        <div class="stepper-wrap"><span style="color:#f87171; font-size:0.8rem">B₁</span><div class="stepper" style="border-color:#f8717133;"><button onclick="step(1,'x',-1)">-</button><input type="text" id="m01_in" oninput="validateInput(1,'x',this)" style="color:#f87171;"><button onclick="step(1,'x',1)">+</button></div></div>
                        <div class="stepper-wrap"><span style="color:#60a5fa; font-size:0.8rem">A₂</span><div class="stepper" style="border-color:#60a5fa33;"><button onclick="step(0,'y',-1)">-</button><input type="text" id="m10_in" oninput="validateInput(0,'y',this)" style="color:#60a5fa;"><button onclick="step(0,'y',1)">+</button></div></div>
                        <div class="stepper-wrap"><span style="color:#f87171; font-size:0.8rem">B₂</span><div class="stepper" style="border-color:#f8717133;"><button onclick="step(1,'y',-1)">-</button><input type="text" id="m11_in" oninput="validateInput(1,'y',this)" style="color:#f87171;"><button onclick="step(1,'y',1)">+</button></div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .custom-checkbox { display: flex; align-items: center; gap: 8px; cursor: pointer; color: #94a3b8; }
    .custom-checkbox input { appearance: none; width: 18px; height: 18px; border: 2px solid #334155; border-radius: 4px; background: #0f172a; cursor: pointer; position: relative; }
    .custom-checkbox input:checked { background: #34d399; border-color: #34d399; }
    .custom-checkbox input:checked::after { content: '✓'; position: absolute; color: #0f172a; font-size: 14px; font-weight: bold; left: 2px; top: -2px; }
    
    .dropdown-group { display: flex; align-items: center; gap: 8px; color: #94a3b8; }
    .dropdown-group select { background: #1e293b; border: 1px solid #334155; color: #fff; border-radius: 4px; outline: none; cursor: pointer; }

    .stepper-wrap { display: flex; align-items: center; gap: 6px; }
    .stepper-wrap > span { font-family: monospace; font-weight: bold; font-size: 0.85rem; color: #64748b; }
    
    .stepper { display: flex; align-items: center; background: #1e293b; border-radius: 6px; overflow: hidden; border: 1px solid #334155; height: 32px; }
    .stepper button { background: #334155; color: #fff; border: none; width: 24px; height: 100%; cursor: pointer; font-weight: bold; font-size: 1.1rem; flex-shrink: 0; }
    .stepper button:hover { background: #475569; }
    .stepper input { width: 55px; background: transparent; border: none; color: #fff; text-align: center; font-family: monospace; font-size: 0.95rem; outline: none; padding: 0; }
    
    .vec-slider { height: 10px; accent-color: #34d399; cursor: pointer; }
    .tool-btn { flex: 1; padding: 8px; font-size: 0.8rem; background: #0f172a; color: #94a3b8; border: 1px solid #334155; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .tool-btn:hover { border-color: #34d399; color: #fff; }

    .rot-container { display: flex; align-items: center; gap: 8px; position: relative; width: 45px; transition: background 0.2s; border-radius: 6px; }
    .rot-container:hover { background: #1e293b44; }
    .rot-slider { 
        appearance: none; width: 100px; height: 6px; background: #1e293b; border-radius: 10px;
        transform: rotate(-90deg); transform-origin: center; position: absolute; left: -25px; top: 45%;
        accent-color: #34d399; cursor: pointer;
    }
    .rot-scale { 
        display: flex; flex-direction: column; justify-content: space-between; height: 100%; 
        font-family: monospace; font-size: 0.65rem; color: #64748b; padding-left: 28px; 
    }
</style>

<script>
    const canvas = document.getElementById('vectorCanvas');
    const ctx = canvas.getContext('2d');
    const center = 250, scale = 70;

    let vectors = [{x:1, y:0, color:'#60a5fa'}, {x:0, y:1, color:'#f87171'}];
    let activeVec = null;
    let hoverRot = null;

    function resetAll() {
        vectors = [{x:1, y:0, color:'#60a5fa'}, {x:0, y:1, color:'#f87171'}];
        document.getElementById('posSnapSelect').value = "0.25";
        document.getElementById('rotSnapSelect').value = "15";
        document.getElementById('angleModeToggle').checked = false;
        document.getElementById('unitToggle').checked = false;
        render();
    }

    function toggleUnitMode() {
        if (document.getElementById('unitToggle').checked) {
            vectors.forEach((v, i) => transform(i, 'norm'));
        }
        render();
    }

    function gcd(a, b) { return b === 0 ? a : gcd(b, a % b); }

    function getFraction(rad) {
        let deg = Math.round(Math.abs(rad * 180 / Math.PI));
        if (deg === 0) return "0";
        let commonAngles = { 
            30: "1/6", 45: "1/4", 60: "1/3", 90: "1/2", 120: "2/3", 135: "3/4", 
            150: "5/6", 180: "1", 270: "3/2", 360: "2" 
        };
        if (commonAngles[deg]) return `(${commonAngles[deg]}π)`;
        let numerator = deg;
        let denominator = 180;
        let divisor = gcd(numerator, denominator);
        return `(${numerator/divisor}/${denominator/divisor}π)`;
    }

    function validateInput(idx, comp, el) {
        let val = el.value.replace(/[^0-9.-]/g, '');
        if (val !== el.value) el.value = val;
        let n = parseFloat(val);
        if (!isNaN(n)) {
            vectors[idx][comp] = n;
            if (document.getElementById('unitToggle').checked) transform(idx, 'norm');
            render('skip-inputs');
        }
    }

    function validateLen(idx, el) {
        let val = el.value.replace(/[^0-9.-]/g, '');
        if (val !== el.value) el.value = val;
        let n = parseFloat(val);
        if (!isNaN(n)) updateLen(idx, n);
    }

    function step(idx, comp, dir) {
        let snap = parseFloat(document.getElementById('posSnapSelect').value);
        vectors[idx][comp] = Math.round((vectors[idx][comp] + (dir * snap)) / snap) * snap;
        if (document.getElementById('unitToggle').checked) transform(idx, 'norm');
        render();
    }

    function stepLen(idx, dir) {
        let snap = parseFloat(document.getElementById('posSnapSelect').value);
        let mag = Math.sqrt(vectors[idx].x**2 + vectors[idx].y**2);
        updateLen(idx, mag + (dir * snap));
    }

    function updateLen(idx, val) {
        if (document.getElementById('unitToggle').checked) return;
        let targetLen = Math.max(0, Math.min(5, parseFloat(val) || 0));
        let v = vectors[idx];
        let mag = Math.sqrt(v.x**2 + v.y**2);
        if (mag === 0) { v.x = targetLen; v.y = 0; }
        else { v.x = (v.x / mag) * targetLen; v.y = (v.y / mag) * targetLen; }
        render('skip-len');
    }

    function rotateVec(idx, deg) {
        let snap = parseInt(document.getElementById('rotSnapSelect').value);
        let snappedDeg = Math.round(deg / snap) * snap;
        let v = vectors[idx];
        let mag = Math.sqrt(v.x**2 + v.y**2);
        if (mag === 0) mag = 1;
        let targetRad = snappedDeg * (Math.PI / 180);
        if (document.getElementById('angleModeToggle').checked) {
            targetRad += Math.atan2(vectors[1-idx].y, vectors[1-idx].x);
        }
        v.x = Math.cos(targetRad) * mag;
        v.y = Math.sin(targetRad) * mag;
        render('skip-rot');
    }

    function transform(idx, type) {
        let v = vectors[idx];
        if (type === 'negate') { v.x *= -1; v.y *= -1; }
        if (type === 'perp') { let t = v.x; v.x = -v.y; v.y = t; }
        if (type === 'norm') { let m = Math.sqrt(v.x**2 + v.y**2); if (m > 0) { v.x /= m; v.y /= m; } }
        render();
    }

    function transpose() {
        let temp = vectors[0].y;
        vectors[0].y = vectors[1].x;
        vectors[1].x = temp;
        if (document.getElementById('unitToggle').checked) {
            transform(0, 'norm'); transform(1, 'norm');
        }
        render();
    }

    function drawGrid() {
        ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.font = "11px monospace";
        for (let i = -5; i <= 5; i += 0.5) {
            let isMain = (i % 1 === 0);
            ctx.lineWidth = (i === 0) ? 2 : (isMain ? 1 : 0.5);
            ctx.strokeStyle = (i === 0) ? '#475569' : '#1e293b';
            let p = center + i * scale;
            ctx.beginPath(); ctx.moveTo(p, 0); ctx.lineTo(p, 500); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, p); ctx.lineTo(500, p); ctx.stroke();
            if (isMain && i !== 0) {
                ctx.fillStyle = "#64748b";
                ctx.fillText(i, p, center + 15);
                ctx.fillText(i, center - 15, center - i * scale);
            }
        }
    }

    function drawAngleArc(v1, v2, color, radius, isDashed = false) {
        let a1 = Math.atan2(-v1.y, v1.x);
        let a2 = Math.atan2(-v2.y, v2.x);
        let diff = a2 - a1;
        while (diff < -Math.PI) diff += Math.PI * 2;
        while (diff > Math.PI) diff -= Math.PI * 2;
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        if (isDashed) ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.arc(center, center, radius, a1, a1 + diff, diff < 0);
        ctx.stroke();
        ctx.setLineDash([]);
        let mid = a1 + diff / 2;
        let degLabel = Math.abs(diff * 180 / Math.PI).toFixed(1) + "°";
        ctx.fillStyle = color;
        ctx.font = "bold 11px monospace";
        ctx.fillText(degLabel, center + (radius + 20) * Math.cos(mid), center + (radius + 20) * Math.sin(mid));
    }

    function render(mode) {
        ctx.clearRect(0, 0, 500, 500);
        drawGrid();
        const [A, B] = vectors;
        drawAngleArc(A, B, "#34d399", 45, true);
        if (hoverRot !== null) {
            let isLocal = document.getElementById('angleModeToggle').checked;
            let ref = isLocal ? vectors[1-hoverRot] : {x:1, y:0};
            drawAngleArc(ref, vectors[hoverRot], "#60a5fa", 70);
        }
        vectors.forEach(v => {
            const tx = center + v.x * scale, ty = center - v.y * scale;
            ctx.strokeStyle = v.color; ctx.fillStyle = v.color; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(center, center); ctx.lineTo(tx, ty); ctx.stroke();
            const ang = Math.atan2(center - ty, tx - center);
            ctx.beginPath(); ctx.moveTo(tx, ty);
            ctx.lineTo(tx-15*Math.cos(ang-Math.PI/6), ty+15*Math.sin(ang-Math.PI/6));
            ctx.lineTo(tx-15*Math.cos(ang+Math.PI/6), ty+15*Math.sin(ang+Math.PI/6));
            ctx.fill();
        });

        const dot = (A.x * B.x) + (A.y * B.y);
        const magA = Math.sqrt(A.x**2 + A.y**2), magB = Math.sqrt(B.x**2 + B.y**2);
        const rad = Math.acos(Math.max(-1, Math.min(1, (magA*magB===0)?0:dot/(magA*magB))));
        const isUnit = document.getElementById('unitToggle').checked;

        if (mode !== 'skip-inputs') {
            document.getElementById('ax_in').value = A.x.toFixed(2);
            document.getElementById('ay_in').value = A.y.toFixed(2);
            document.getElementById('bx_in').value = B.x.toFixed(2);
            document.getElementById('by_in').value = B.y.toFixed(2);
            document.getElementById('m00_in').value = A.x.toFixed(2);
            document.getElementById('m10_in').value = A.y.toFixed(2);
            document.getElementById('m01_in').value = B.x.toFixed(2);
            document.getElementById('m11_in').value = B.y.toFixed(2);
        }
        if (mode !== 'skip-len') {
            document.getElementById('len0_in').value = magA.toFixed(2);
            document.getElementById('len1_in').value = magB.toFixed(2);
            document.getElementById('slider0').value = magA;
            document.getElementById('slider1').value = magB;
        }
        if (mode !== 'skip-rot') {
            const isLocal = document.getElementById('angleModeToggle').checked;
            [0, 1].forEach(i => {
                let ang = (Math.atan2(vectors[i].y, vectors[i].x) * 180 / Math.PI + 360) % 360;
                if (isLocal) {
                    let other = (Math.atan2(vectors[1-i].y, vectors[1-i].x) * 180 / Math.PI + 360) % 360;
                    ang = (ang - other + 360) % 360;
                }
                document.getElementById(`rotSlider${i}`).value = Math.round(ang);
            });
        }

        document.getElementById('slider0').disabled = isUnit;
        document.getElementById('slider1').disabled = isUnit;
        document.getElementById('len0_in').disabled = isUnit;
        document.getElementById('len1_in').disabled = isUnit;

        document.getElementById('resDot').innerText = dot.toFixed(3);
        document.getElementById('resCos').innerText = ((magA*magB===0)?0:dot/(magA*magB)).toFixed(3);
        document.getElementById('resDeg').innerText = (rad * 180 / Math.PI).toFixed(1);
        document.getElementById('resRad').innerText = rad.toFixed(3);
        document.getElementById('resPi').innerText = (rad / Math.PI).toFixed(3) + "π";
        document.getElementById('resFrac').innerText = getFraction(rad);
    }

    canvas.addEventListener('mousemove', (e) => {
        const r = canvas.getBoundingClientRect();
        const x = ((e.clientX - r.left) * (500 / r.width) - center) / scale;
        const y = -((e.clientY - r.top) * (500 / r.height) - center) / scale;
        document.getElementById('originCoords').innerHTML = `<span>Pos: (${x.toFixed(2)}, ${y.toFixed(2)})</span><span style="color: #34d399;">Dist: ${Math.sqrt(x*x+y*y).toFixed(2)}</span>`;
        if (activeVec) {
            let snap = parseFloat(document.getElementById('posSnapSelect').value);
            activeVec.x = Math.round(x / snap) * snap;
            activeVec.y = Math.round(y / snap) * snap;
            if (document.getElementById('unitToggle').checked) {
                transform(vectors.indexOf(activeVec), 'norm');
            }
            render();
        }
    });

    canvas.addEventListener('mousedown', (e) => {
        const r = canvas.getBoundingClientRect();
        const mx = (e.clientX - r.left) * (500 / r.width), my = (e.clientY - r.top) * (500 / r.height);
        vectors.forEach(v => {
            if (Math.sqrt((mx - (center + v.x * scale))**2 + (my - (center - v.y * scale))**2) < 30) activeVec = v;
        });
    });

    window.addEventListener('mouseup', () => activeVec = null);
    render();
</script>